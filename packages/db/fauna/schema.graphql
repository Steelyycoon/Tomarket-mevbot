type User {
  name: String!
  picture: String
  email: String!
  issuer: String! @unique
  """
  GitHub user handle, may be null if user logged in via email.
  """
  github: String
  """
  Cryptographic public address of the Magic User.
  """
  publicAddress: String!
  """
  User authentification keys.
  """
  keys: [AuthKey!]! @relation
  created: Time!
}

type AuthKey {
  """
  User assigned name.
  """
  name: String!

  """
  Secret that corresponds to this key.
  """
  secret: String!

  """
  Uploads made using this key.
  """
  uploads: [Upload!]! @relation @index

  """
  User this key belongs to.
  """
  user: User! @relation @index
}

type Asset {
  """
  CID that corresponds to this asset.
  """
  cid: String! @unique

  """
  Deals referencing this asset.
  """
  deals: [Deal!]! @relation

  """
  Size of the DAG that makes up this asset.
  """
  dagSize: Int!

  """
  Pin status of this asset.
  """
  pinStatus: PinStatus! @index

  """
  Identifier for the known location where this asset is pinned.
  """
  pinLocation: String!
}

enum PinStatus {
  Undefined
  ClusterError
  PinError
  UnpinError
  Pinned
  Pinning
  Unpinned
  Remote
  PinQueued
  UnpinQueued
  Sharded
}

type Upload {
  """
  User that uploaded this content.
  """
  user: User! @relation @index

  """
  User auth key that was used to upload this content.
  """
  authKey: AuthKey

  """
  Asset representing the root of the uploaded content.
  """
  asset: Asset! @relation

  created: Time! @index

  deleted: Time
}

type Deal {
  """
  CIDs in this deal.
  """
  assets: [Asset!]! @relation @index

  """
  ID of miner this deal was made with.
  """
  miner: String

  """
  Filecoin network deal is made on.
  """
  network: String

  """
  Piece CID.
  """
  pieceCid: String

  """
  CID of the root of the batch data.
  """
  batchRootCid: String

  """
  Identifier for the deal stored on chain.
  """
  chainDealId: Int

  """
  Selector for extracting stored data from the batch root.
  """
  dataModelSelector: String

  """
  Time when deal will be active.
  """
  activation: Time

  """
  Time when deal has expired and will renew.
  """
  renewal: Time

  """
  Current deal status.
  """
  status: DealStatus!

  """
  Human readable reason for the current status.
  """
  statusReason: String

  """
  Last time this deal was updated.
  """
  updated: Time!
}

enum DealStatus {
  Queued
  Proposing
  Accepted
  Failed
  Published
  Active
  Terminated
}

type Query {
  findUploads(where: FindUploadsInput): [Upload!]! @resolver(paginated: true)
  findAssetByCid(cid: String!): Asset @resolver
  findUserByIssuer(issuer: String!): User @resolver
  findAuthKeys(user: ID!): [AuthKey!]! @resolver
}

type Mutation {
  createOrUpdateUser(input: CreateUserInput!): User! @resolver
  createAuthKey(input: CreateAuthKeyInput!): AuthKey! @resolver
  createUpload(input: CreateUploadInput!): Upload! @resolver
  updateAsset(input: UpdateAssetInput!): Asset! @resolver
}

input FindUploadsInput {
  before: Time!
}

input CreateUserInput {
  name: String!
  picture: String
  email: String!
  issuer: String!
  github: String
  publicAddress: String!
}

input CreateAuthKeyInput {
  user: ID!
  name: String!
  secret: String!
}

input CreateUploadInput {
  user: ID!
  cid: String!
  dagSize: Int
}

input UpdateAssetInput {
  cid: String!
  pinStatus: PinStatus
  dagSize: Int
}
